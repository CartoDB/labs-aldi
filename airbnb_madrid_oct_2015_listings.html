<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>CartoDB.js: Airbnb Oct. 2015 Madrid listings</title>
    <meta name=viewport content="width=device-width initial-scale=1">
    <link rel="stylesheet" href="./themes/css/cartodb.css" />
    <script src="./cartodb.uncompressed.js"></script>
    <style type="text/css">
      html, body {
        position:relative;
        height: 100%;
        padding: 0;
        margin: 0;
      }
    </style>
  </head>
  <body>

    <div class="Dashboard-canvas" id="dashboard"></div>

    <script>
      window.onload = function() {
          var VIZJSON = {
              "id": "84ec6844-4b4b-11e5-9c1d-080027880ca6",
              "version": "0.1.0",
              "title": "Airbnb Madrid",
              "likes": 0,
              "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed vulputate consequat vehicula. Sed eget leo a ex tempus cursus. Etiam consectetur cursus tortor, id dapibus elit condimentum id. Nulla sed gravida lorem, at ornare lectus. Aliquam quis erat porttitor, varius lectus eget, rhoncus mi...",
              "scrollwheel": false,
              "legends": true,
              "url": null,
              "map_provider": "leaflet",
              "user": {
                "fullname": "Emilio García",
                "avatar_url": "https://s3.amazonaws.com/com.cartodb.users-assets.production/production/piensaenpixel/assets/20150507074635Captura%20de%20pantalla%202015-05-07%20a%20la%28s%29%2009.46.28.png"
              },
              "bounds": [
                  [
                      40.63,
                      -3.46
                  ],
                  [
                      40.22,
                      -3.78
                  ]
              ],
              "center": "[40.84706035607122, -98.39355468749999]",
              "zoom": 4,
              "updated_at": "2015-10-26T11:50:30+00:00",
              "layers": [
                  {
                      "options": {
                          "visible": true,
                          "type": "Tiled",
                          "name": "Positron",
                          "className": "httpsbasemapscartocdncomlight_nolabelszxypng",
                          "base_type": "default",
                          "urlTemplate": "http://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}.png",
                          "minZoom": "0",
                          "maxZoom": "18",
                          "attribution": "© <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors © <a href= \"http://cartodb.com/attributions#basemaps\">CartoDB</a>",
                          "subdomains": "abcd",
                          "style": null,
                          "labels": {
                              "url": "http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png"
                          },
                          "read_only": true,
                          "category": "CartoDB",
                          "order": 0,
                          "id": "a4b5985f-5757-4ff3-8957-01e41247318c",
                          "parent_id": null
                      },
                      "infowindow": null,
                      "tooltip": null,
                      "id": "a4b5985f-5757-4ff3-8957-01e41247318c",
                      "order": 0,
                      "type": "tiled"
                  },
                  {
                      "type": "layergroup",
                      "options": {
                          "layer_definition": {
                              "stat_tag": "84ec6844-4b4b-11e5-9c1d-080020ca7886",
                              "version": "1.0.1",
                              "layers": [
                                  {
                                      "id": "4d82e8df-f21b-4225-b776-1b1bdffde6c6",
                                      "type": "CartoDB",
                                      "order": 1,
                                      "visible": true,
                                      "options": {
                                          "sql": [
                                              "SELECT *, GREATEST(4, POWER(LOG(price), 3)) price_width",
                                              "FROM airbnb_madrid_oct_2015_listings",
                                              "ORDER BY price_width DESC"
                                          ].join(' '),
                                          "cartocss": ['#airbnb_may_2015_listings {',
                                              'marker-fill-opacity: 0.03;',
                                              'marker-line-color: #FFF;',
                                              'marker-line-width: 0.3;',
                                              'marker-line-opacity: 0.15;',
                                              'marker-placement: point;',
                                              'marker-type: ellipse;',
                                              'marker-width: [price_width];',
                                              'marker-fill: #e00007;',
                                              'marker-allow-overlap: true;',
                                              '}'].join(''),
                                          "cartocss_version": "2.3.0"
                                      }
                                  },
                                  {
                                      "id": "4d82e8df-f21b-4225-b776-61b1bdffde6c",
                                      "type": "CartoDB",
                                      "interactivity": "cartodb_id,name,room_type,price,minimum_nights,accommodates,guests_included,extra_people,review_scores_value,bedrooms,beds,bathrooms,city,neighbourhood",
                                      "infowindow": {
                                          "fields": [],
                                          "template_name": "table/views/infowindow_light",
                                          "template": "<div class=\"cartodb-popup v2\">\n  <a href=\"#close\" class=\"cartodb-popup-close-button close\">x</a>\n  <div class=\"cartodb-popup-content-wrapper\">\n    <div class=\"cartodb-popup-content\">\n      {{#content.fields}}\n        {{#title}}<h4>{{title}}</h4>{{/title}}\n        {{#value}}\n          <p {{#type}}class=\"{{ type }}\"{{/type}}>{{{ value }}}</p>\n        {{/value}}\n        {{^value}}\n          <p class=\"empty\">null</p>\n        {{/value}}\n      {{/content.fields}}\n    </div>\n  </div>\n  <div class=\"cartodb-popup-tip-container\"></div>\n</div>\n",
                                          "alternative_names": {},
                                          "width": 226,
                                          "maxHeight": 180
                                      },
                                      "tooltip": {
                                          "fields": [
                                              {
                                                  "name": "name",
                                                  "title": true,
                                                  "position": 1
                                              },
                                              {
                                                  "name": "room_type",
                                                  "title": true,
                                                  "position": 2
                                              },
                                              {
                                                  "name": "price",
                                                  "title": true,
                                                  "position": 3
                                              },
                                              {
                                                  "name": "minimum_nights",
                                                  "title": true,
                                                  "position": 4
                                              },
                                              {
                                                  "name": "accommodates",
                                                  "title": true,
                                                  "position": 5
                                              },
                                              {
                                                  "name": "guests_included",
                                                  "title": true,
                                                  "position": 6
                                              },
                                              {
                                                  "name": "extra_people",
                                                  "title": true,
                                                  "position": 7
                                              },
                                              {
                                                  "name": "review_scores_value",
                                                  "title": true,
                                                  "position": 8
                                              },
                                              {
                                                  "name": "bedrooms",
                                                  "title": true,
                                                  "position": 9
                                              },
                                              {
                                                  "name": "beds",
                                                  "title": true,
                                                  "position": 10
                                              },
                                              {
                                                  "name": "bathrooms",
                                                  "title": true,
                                                  "position": 11
                                              },
                                              {
                                                  "name": "city",
                                                  "title": true,
                                                  "position": 12
                                              },
                                              {
                                                  "name": "neighbourhood",
                                                  "title": true,
                                                  "position": 13
                                              },
                                              {
                                                  "name": "host_id",
                                                  "title": true,
                                                  "position": 14
                                              }
                                          ],
                                          "template_name": "tooltip_light",
                                          "template": "<div class=\"cartodb-tooltip-content-wrapper\">\n  <div class=\"cartodb-tooltip-content\">\n  {{#fields}}\n    {{#title}}\n    <h4>{{title}}</h4>\n    {{/title}}\n    <p>{{{ value }}}</p>\n  {{/fields}}\n  </div>\n</div>",
                                          "alternative_names": {},
                                          "maxHeight": 180
                                      },
                                      "legend": {
                                          "type": "none",
                                          "show_title": false,
                                          "title": "",
                                          "template": "",
                                          "visible": true
                                      },
                                      "order": 1,
                                      "visible": true,
                                      "options": {
                                          "sql": [
                                              "SELECT *, GREATEST(4, POWER(LOG(price), 3)) price_width",
                                              "FROM airbnb_madrid_oct_2015_listings",
                                              "ORDER BY price_width DESC"
                                          ].join(' '),
                                          "layer_name": "Airbnb",
                                          "cartocss": ['#airbnb_may_2015_listings {',
                                              'marker-fill-opacity: 1.0;',
                                              'marker-line-color: #fff;',
                                              'marker-line-width: 0.7;',
                                              'marker-line-opacity: 0.8;',
                                              'marker-placement: point;',
                                              'marker-type: ellipse;',
                                              'marker-width: [price_width];',
                                              'marker-fill: #e00007;',
                                              'marker-allow-overlap: true;',
                                              '}'].join(''),
                                          "cartocss_version": "2.1.1",
                                          "interactivity": "cartodb_id,name,room_type,price,minimum_nights,accommodates,guests_included,extra_people,review_scores_value,bedrooms,beds,bathrooms,city,neighbourhood",
                                          "table_name": "\"\".",
                                          "widgets": {
                                              "histogram_widget_price": {
                                                  "type": "histogram",
                                                  "title": "Price per night",
                                                  "column": "price",
                                                  "bins": 10
                                              },
                                              'histogram_widget_review_scores_value': {
                                                  "type": "histogram",
                                                  "title": "Review score",
                                                  "column": "review_scores_value",
                                                  "sync": true
                                              },
                                              'category_widget_room_type': {
                                                  "type": "aggregation",
                                                  "title": "Room type",
                                                  "column": "room_type",
                                                  "aggregation": "count",
                                                  "sync": true
                                              },
                                              'category_widget_neighbourhood': {
                                                  "type": "aggregation",
                                                  "title": "Neighbourhood",
                                                  "column": "neighbourhood_cleansed",
                                                  "aggregation": "count",
                                                  "sync": true
                                              },
                                              'category_widget_host_name': {
                                                  "type": "aggregation",
                                                  "title": "Host Name",
                                                  "column": "host_name",
                                                  "aggregation": "count",
                                                  "sync": true
                                              },
                                              'category_widget_bedrooms': {
                                                  "type": "aggregation",
                                                  "title": "Number of Bedrooms",
                                                  "column": "bedrooms",
                                                  "aggregation": "count",
                                                  "sync": true
                                              },
                                              'formula_widget_price_avg': {
                                                  "type": "formula",
                                                  "title": "Average price",
                                                  "column": "price",
                                                  "operation": "avg",
                                                  "prefix": "$"
                                              },
                                              'formula_widget_min': {
                                                  "type": "formula",
                                                  "title": "Minimum price",
                                                  "column": "price",
                                                  "operation": "min",
                                                  "prefix": "$"
                                              },
                                              'formula_widget_max': {
                                                  "type": "formula",
                                                  "title": "Maximum price",
                                                  "column": "price",
                                                  "operation": "max",
                                                  "prefix": "$"
                                              }
                                          }
                                      }
                                  }
                              ]
                          },
                          "attribution": "wadus"
                      }
                  }
              ],
              "overlays": [
                  {
                      "type": "share",
                      "order": 2,
                      "options": {
                          "display": true,
                          "x": 20,
                          "y": 20
                      },
                      "template": ""
                  },
                  {
                      "type": "search",
                      "order": 3,
                      "options": {
                          "display": true,
                          "x": 60,
                          "y": 20
                      },
                      "template": ""
                  },
                  {
                      "type": "zoom",
                      "order": 6,
                      "options": {
                          "display": true,
                          "x": 20,
                          "y": 20
                      },
                      "template": "<a href=\"#zoom_in\" class=\"zoom_in\">+</a> <a href=\"#zoom_out\" class=\"zoom_out\">-</a>"
                  },
                  {
                      "type": "loader",
                      "order": 8,
                      "options": {
                          "display": true,
                          "x": 20,
                          "y": 150
                      },
                      "template": "<div class=\"loader\" original-title=\"\"></div>"
                  },
                  {
                      "type": "logo",
                      "order": 9,
                      "options": {
                          "display": true,
                          "x": 10,
                          "y": 40
                      },
                      "template": ""
                  }
              ],
              "prev": null,
              "next": null,
              "transition_options": {
                  "time": 0
              },
              "datasource": {
                  "type": "public_map",
                  "user_name": "rochoa-st-ded02",
                  "maps_api_template": "https://{user}.cartodb-staging.com:443",
                  "stat_tag": "ece6faac-7271-11e5-a85f-04013fc66a01",
                  "force_cors": true // This is sometimes set in the editor
              }
          };

          cartodb.createVis('dashboard', VIZJSON, {
              no_cdn: false
          })
          .done(function(vis, layers) {
            window.vis = vis;
            window.map = vis.getNativeMap();
            window.layers = layers.models[1].layers;
          })
          .error(function(err) {
            console.log(err);
          });
      }
    </script>
  </body>
</html>
