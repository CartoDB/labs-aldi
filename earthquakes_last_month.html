<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CartoDB.js – EarthQuakes last month</title>
    <meta name=viewport content="width=device-width initial-scale=1">
    <link rel="stylesheet" href="./themes/css/cartodb.css" />
    <script src="./cartodb.uncompressed.js"></script>
    <script src="./cartodb.mod.torque.uncompressed.js"></script>
    <style type="text/css">
      html, body {
        position:relative;
        height: 100%;
        padding: 0;
        margin: 0;
      }
    </style>
</head>
<body>

  <div id="dashboard"></div>

<script>
window.onload = function() {
    var VIZJSON = {
        "id": "84ec6844-4b4b-11e5-9c1d-080027880ca6",
        "version": "0.1.0",
        "title": "Earthquakes last month",
        "likes": 0,
        "description": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed vulputate consequat vehicula. Sed eget leo a ex tempus cursus. Etiam consectetur cursus tortor, id dapibus elit condimentum id. Nulla sed gravida lorem, at ornare lectus. Aliquam quis erat porttitor, varius lectus eget, rhoncus mi...",
        "scrollwheel": false,
        "legends": true,
        "url": null,
        "map_provider": "leaflet",
        "user": {
          "fullname": "Emilio García",
          "avatar_url": "https://s3.amazonaws.com/com.cartodb.users-assets.production/production/piensaenpixel/assets/20150507074635Captura%20de%20pantalla%202015-05-07%20a%20la%28s%29%2009.46.28.png"
        },
        "bounds": [
          [
            78.56048828398782,
            210.234375
          ],
          [
            -47.75409797968002,
            -130.078125
          ]
        ],
        "center": "[40.84706035607122, -98.39355468749999]",
        "zoom": 3,
        "updated_at": "2015-11-30T11:50:30+00:00",
        "layers": [
            {
                "options": {
                    "visible": true,
                    "type": "Tiled",
                    "name": "Positron",
                    "className": "httpsbasemapscartocdncomlight_nolabelszxypng",
                    "base_type": "default",
                    "urlTemplate": "http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",
                    "minZoom": "0",
                    "maxZoom": "18",
                    "attribution": "© <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors © <a href= \"http://cartodb.com/attributions#basemaps\">CartoDB</a>",
                    "subdomains": "abcd",
                    "style": null,
                    "read_only": true,
                    "category": "CartoDB",
                    "order": 0,
                    "id": "a4b5985f-5757-4ff3-8957-01e41247318c",
                    "parent_id": null
                },
                "infowindow": null,
                "tooltip": null,
                "id": "a4b5985f-5757-4ff3-8957-01e41247318c",
                "order": 0,
                "type": "tiled"
            },
            {
              "id": "25b45f28-9757-11e5-9944-04013fc66a01",
              "type": "torque",
              "stat_tag": "4c07a352-892d-11e5-9380-080027880ca6",
              "sql_api_template": "http://{user}.cartodb-staging.com:80",
              "tiler_protocol": "http",
              "tiler_domain": "cartodb-staging.com",
              "tiler_port": "80",
              "sql_api_protocol": "http",
              "sql_api_domain": "cartodb-staging.com",
              "sql_api_endpoint": "/api/v1/sql",
              "sql_api_port": 80,
              "visible": true,
              "user_name": "common-data-ded02",
              "maps_api_template": "http://{user}.cartodb-staging.com:80",
              "table_name": "earthquakes_last_month",
              "layer_name": "earthquakes_last_month",
              "visible": true,
              "options": {
                // TODO extract is a hack, until Winshaft can handle a Date column
                "sql": "select *, extract(epoch from time) AS moment from earthquakes_last_month",
                "layer_name": "earthquakes_last_month",
                "cartocss": [
                  "Map{",
                  "-torque-frame-count:256;",
                  "-torque-resolution:1;",
                  "-torque-aggregation-function:'count(cartodb_id)';",
                  "-torque-time-attribute:'time';",
                  "-torque-data-aggregation:linear;",
                  "-torque-animation-duration:30;",
                  "}",
                  "#earthquakes_last_month{\n  comp-op: lighter;\n  marker-fill-opacity: 0.9;\n  marker-line-color: #FFF;\n  marker-line-width: 0;\n  marker-line-opacity: 1;\n  marker-type: ellipse;\n  marker-width: 6;\n  marker-fill: #0F3B82;\n}",
                  "#earthquakes_last_month[frame-offset=1] {\n marker-width:8;\n marker-fill-opacity:0.45; \n}\n",
                  "#earthquakes_last_month[frame-offset=2] {\n marker-width:10;\n marker-fill-opacity:0.225; \n}"
                ].join(''),
                "cartocss_version": "2.1.1",
                "interactivity": "cartodb_id, type, moment",
                "table_name": "earthquakes_last_month"
              },
              "widgets": {
                "time_series_widget_uuid": {
                  "type": "time-series",
                  "column": "moment",
                  // TODO initial request is hardcoded until the tiler can resolve this itself
                  "bins": 256,
                  "start": 1446292117,
                  "end": 1448882871
                },
                "category_widget_uuid": {
                  "type": "aggregation",
                  "title": "Earthquake types",
                  "column": "type",
                  "aggregation": "count"
                }
              }
            }
        ],
        "overlays": [
            {
                "type": "share",
                "order": 2,
                "options": {
                    "display": true,
                    "x": 20,
                    "y": 20
                },
                "template": ""
            },
            {
                "type": "search",
                "order": 3,
                "options": {
                    "display": true,
                    "x": 60,
                    "y": 20
                },
                "template": ""
            },
            {
                "type": "zoom",
                "order": 6,
                "options": {
                    "display": true,
                    "x": 20,
                    "y": 20
                },
                "template": "<a href=\"#zoom_in\" class=\"zoom_in\">+</a> <a href=\"#zoom_out\" class=\"zoom_out\">-</a>"
            },
            {
                "type": "loader",
                "order": 8,
                "options": {
                    "display": true,
                    "x": 20,
                    "y": 150
                },
                "template": "<div class=\"loader\" original-title=\"\"></div>"
            },
            {
                "type": "logo",
                "order": 9,
                "options": {
                    "display": true,
                    "x": 10,
                    "y": 40
                },
                "template": ""
            }
        ],
        "prev": null,
        "next": null,
        "transition_options": {
            "time": 0
        },
        "datasource": {
            "type": "public_map",
            "user_name": "common-data-ded02",
            "maps_api_template": "https://{user}.cartodb-staging.com:443",
            "stat_tag": "ece6faac-7271-11e5-a85f-04013fc66a01",
            "force_cors": true // This is sometimes set in the editor
        }
    };

    cartodb.createVis('dashboard', VIZJSON, {
        no_cdn: false
    })
    .done(function(vis, layers) {
      window.vis = vis;
      window.map = vis.getNativeMap();
      window.layers = layers.models[1].layers;
    })
    .error(function(err) {
      console.log(err);
    });
}
</script>
</body>
</html>
