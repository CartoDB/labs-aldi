<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Deep-Insights.js â€“ Madrid: Airbnb, nightlife, and public transport</title>
  <meta name=viewport content="width=device-width initial-scale=1">
  <link href="http://cartodb.com/favicon.ico" rel="shortcut icon" />
  <link href="deep-insights.js/dist/themes/css/deep-insights.css" rel="stylesheet" />
  <script src="deep-insights.js/dist/deep-insights.uncompressed.js"></script>
  <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
  <style type="text/css">
    html,
    body {
      position: relative;
      height: 100%;
      padding: 0;
      margin: 0;
    }
    .cartodb-tooltip-content {
      color: #FFF;
    }
  </style>
</head>

<body>
  <div class="Dashboard-canvas" id="dashboard"></div>

  <script>
var widgetInfo = {};

window.onload = function() {

   var vizJSONUrl = 'telco.viz.json';

   $.getJSON(vizJSONUrl, function(vizJSON) {
      var diJSON =  { 
     "title":"Telco Demographic Targeting",
      "description":"The map shows current retail locations and cell tower locations overlaid on census tracts.  When the user selects a priority demographics using the histogram widgets, the map colors will update to show which areas best match the current selections",
      "user":{  
         "fullname":"Chris Whong",
         "avatar_url":"https://pbs.twimg.com/profile_images/3057855429/49cff02ea1ea88993d7edadd8b027982.jpeg"
      },
      "updated_at":"2016-01-31T11:50:30+00:00",

     "datasource":{  
         "type":"public_map",
         "user_name":"solutions-ded02",
         "maps_api_template":"https://{user}.cartodb-staging.com:443",
         "stat_tag":"be7a4d14-c3a1-11e5-afb7-04013fc66a01",
         "force_cors":true      // This is sometimes set in the editor
      },
      "widgets":[
         {
            "type":"histogram",
            "layerIndex": 1,
            "title":"Median Age",
            "options": {
              "column":"median_age",
              "bins":10          
            }
         },
         {
            "type":"histogram",
            "layerIndex": 1,
            "title":"Median Income",
            "options": {
              "column":"median_household_income",
              "bins":10          
            }
         }, 
         {
            "type": "formula",
            "title": "Retail Locations",
            "layerIndex": 3,
            "options": {
               "column": "cartodb_id",
               "operation": "count"
            }
         },
         {
            "type": "formula",
            "title": "Tower Locations",
            "layerIndex": 4,
            "options": {
               "column": "cartodb_id",
               "operation": "count"
            }
         }
       ]  
      }

      vizJSON.overlays.push(
         {
              "type": "zoom",
              "order": 6,
              "options": {
                "display": true,
                "x": 20,
                "y": 20
              },
            "template": "<div class=\"CDB-Overlay\"><button class=\"CDB-Zoom-action CDB-Zoom-action--out js-zoomOut\"></button><button class=\"CDB-Zoom-action CDB-Zoom-action--in js-zoomIn\"></button></div><div class=\"CDB-Zoom-info js-zoomInfo\">1</div>"
          }
      )


      console.log(vizJSON);

      vizJSON.layers[1].options.layer_definition.layers[0].tooltip.template = "<div class='CDB-Tooltip CDB-Tooltip--isLight'><ul class=\"CDB-Tooltip-list\">\n \n <li class=\"CDB-Tooltip-listItem\"><h4 class=\"CDB-Tooltip-listTitle\">Neighborhood</h4><p class=\"CDB-Tooltip-listText\">{{ntaname}}</p></li><li class=\"CDB-Tooltip-listItem\"><h4 class=\"CDB-Tooltip-listTitle\">Median Age</h4><p class=\"CDB-Tooltip-listText\">{{median_age}}</p></li><li class=\"CDB-Tooltip-listItem\"><h4 class=\"CDB-Tooltip-listTitle\">Median Household Income</h4><p class=\"CDB-Tooltip-listText\">${{median_household_income}}</p></li> \n </ul></div>"

      $.extend(vizJSON, diJSON);   
      cartodb.deepInsights.createDashboard('#dashboard', vizJSON, {  
         no_cdn:false
      });
   });
}





        

  </script>
</body>

</html>
